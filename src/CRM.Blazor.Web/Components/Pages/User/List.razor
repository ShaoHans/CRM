@page "/User/List"
@using Microsoft.AspNetCore.Authorization
@using Volo.Abp.Identity
@using Volo.Abp.Users
@attribute [Authorize(IdentityPermissions.Users.Default)]
@inherits AbpCrudPageBase<IIdentityUserAppService, IdentityUserDto, Guid, GetIdentityUsersInput, IdentityUserCreateDto, IdentityUserUpdateDto>

<PageTitle>用户列表</PageTitle>

<RadzenCard class="rz-my-6">
    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Wrap="FlexWrap.Wrap">
        @if(HasCreatePermission)
        {
            <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
                <RadzenButton Icon="add" Text="添加用户" Click="@(async()=>{await OpenCreateDialogAsync<Create>("添加用户", SetDialogOptions);})" />
            </RadzenStack>
        }
        <RadzenStack Orientation="Orientation.Vertical" style="margin-left: auto;" Gap="4px">
            <SearchTextBox PlaceHoder="用户名/邮箱/手机号码" @bind-Keyword="@_keyword" SearchAsync="@_grid.Reload" />
        </RadzenStack>
    </RadzenStack>
</RadzenCard>

<RadzenDataGrid @ref="_grid" Data="@_entities" AllowPaging="true" AllowSorting="true"
                PagerHorizontalAlign="HorizontalAlign.Center"
                PageSizeOptions="@_pageSizeOptions" ShowPagingSummary="@_showPagerSummary" LoadData="LoadDataAsync"
                Count="@_totalCount" IsLoading="@_isLoading">    
    <Columns>
        <RadzenDataGridColumn Property="@nameof(IdentityUserDto.Id)" Title="ID" Width="80px" Visible="false" />
        <RadzenDataGridColumn Property="@nameof(IdentityUserDto.UserName)" Title="用户名" Width="160px" />
        <RadzenDataGridColumn Property="@nameof(IdentityUserDto.Email)" Title="邮箱" Width="160px" />
        <RadzenDataGridColumn Property="@nameof(IdentityUserDto.PhoneNumber)" Title="手机号码" Width="160px" />
        <RadzenDataGridColumn Title="启用" Width="60px" Filterable="false" Sortable="false">
            <Template>
                <BooleanIcon Value="@context.IsActive" />
                @* <RadzenSwitch Value="@context.IsActive"  Disabled="true" Name="False" /> *@
                @* <RadzenCheckBox TValue="bool" Value="@(context.IsActive)" ReadOnly="true" /> *@
            </Template>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn Title="账户锁定" Width="80px" Filterable="false" Sortable="false">
            <Template>
                <BooleanIcon Value="@context.LockoutEnabled" />
                @* <RadzenCheckBox TValue="bool" Value="@(context.LockoutEnabled)" ReadOnly="true" /> *@
            </Template>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn Property="@nameof(IdentityUserDto.CreationTime)" Filterable="false" Title="添加时间" Width="160px" />
        <RadzenDataGridColumn Title="操作" Width="160px" Filterable="false" Sortable="false">
            <Template>
                @if (HasUpdatePermission)
                {
                    <RadzenButton Icon="edit" title="编辑" ButtonStyle="ButtonStyle.Success"
                                  Click="@(async () => await OpenEditDialogAsync<Edit>("编辑用户", context, SetDialogOptions))" />
                }
                @if (HasManagePermissionsPermission)
                {
                    <RadzenButton Icon="productivity" title="权限" ButtonStyle="ButtonStyle.Warning"
                                  Click="@(async () => await OpenAssignPermissionDialog(context))" />
                }
                @if (context.UserName != "admin" && HasDeletePermission)
                {
                    <RadzenButton Icon="delete" title="删除" ButtonStyle="ButtonStyle.Danger"
                                  Click=@(async () => await OpenDeleteConfirmDialogAsync(context.Id, L["Delete"], L["UserDeletionConfirmationMessage",context.UserName])) />
                }
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>
    